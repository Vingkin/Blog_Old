<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JVM | Vingkin的学习文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/Blog/vuepress/favicon.ico">
    <script language="javascript" type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script language="javascript" type="text/javascript" src="/Blog/js/MouseClickEffect.js"></script>
    <meta name="description" content="~~~">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/Blog/assets/css/0.styles.17f0d514.css" as="style"><link rel="preload" href="/Blog/assets/js/app.4417eb82.js" as="script"><link rel="preload" href="/Blog/assets/js/3.2daec6eb.js" as="script"><link rel="preload" href="/Blog/assets/js/1.3441dec7.js" as="script"><link rel="preload" href="/Blog/assets/js/31.c79fd8b8.js" as="script"><link rel="prefetch" href="/Blog/assets/js/10.f0f7997f.js"><link rel="prefetch" href="/Blog/assets/js/11.385157e5.js"><link rel="prefetch" href="/Blog/assets/js/12.43533bfe.js"><link rel="prefetch" href="/Blog/assets/js/13.fca9ec1a.js"><link rel="prefetch" href="/Blog/assets/js/14.4ef5a506.js"><link rel="prefetch" href="/Blog/assets/js/15.25d1439b.js"><link rel="prefetch" href="/Blog/assets/js/16.e4200779.js"><link rel="prefetch" href="/Blog/assets/js/17.0f620a4b.js"><link rel="prefetch" href="/Blog/assets/js/18.3e2c61c2.js"><link rel="prefetch" href="/Blog/assets/js/19.c841fda6.js"><link rel="prefetch" href="/Blog/assets/js/20.7e7aa66c.js"><link rel="prefetch" href="/Blog/assets/js/21.c4003560.js"><link rel="prefetch" href="/Blog/assets/js/22.0406d90f.js"><link rel="prefetch" href="/Blog/assets/js/23.71a12a58.js"><link rel="prefetch" href="/Blog/assets/js/24.dae641fb.js"><link rel="prefetch" href="/Blog/assets/js/25.219b65bd.js"><link rel="prefetch" href="/Blog/assets/js/26.4e8222ba.js"><link rel="prefetch" href="/Blog/assets/js/27.09e9f908.js"><link rel="prefetch" href="/Blog/assets/js/28.c3952bad.js"><link rel="prefetch" href="/Blog/assets/js/29.6f972569.js"><link rel="prefetch" href="/Blog/assets/js/30.c34fffbe.js"><link rel="prefetch" href="/Blog/assets/js/32.e8d64e7e.js"><link rel="prefetch" href="/Blog/assets/js/33.d1b0b891.js"><link rel="prefetch" href="/Blog/assets/js/34.1f6ad2c0.js"><link rel="prefetch" href="/Blog/assets/js/35.1fac3064.js"><link rel="prefetch" href="/Blog/assets/js/36.80d4f061.js"><link rel="prefetch" href="/Blog/assets/js/37.7aa2ac27.js"><link rel="prefetch" href="/Blog/assets/js/38.2e6db6ef.js"><link rel="prefetch" href="/Blog/assets/js/39.c694788f.js"><link rel="prefetch" href="/Blog/assets/js/4.75bd0991.js"><link rel="prefetch" href="/Blog/assets/js/40.f46a350c.js"><link rel="prefetch" href="/Blog/assets/js/41.31e6560f.js"><link rel="prefetch" href="/Blog/assets/js/42.97d443e9.js"><link rel="prefetch" href="/Blog/assets/js/43.bd75055b.js"><link rel="prefetch" href="/Blog/assets/js/44.155af8d3.js"><link rel="prefetch" href="/Blog/assets/js/45.a371798f.js"><link rel="prefetch" href="/Blog/assets/js/46.01c1199d.js"><link rel="prefetch" href="/Blog/assets/js/47.d4a385db.js"><link rel="prefetch" href="/Blog/assets/js/48.0ebb7ce7.js"><link rel="prefetch" href="/Blog/assets/js/49.b1cab958.js"><link rel="prefetch" href="/Blog/assets/js/5.fb11ee35.js"><link rel="prefetch" href="/Blog/assets/js/50.6b058eb4.js"><link rel="prefetch" href="/Blog/assets/js/51.a5d807a2.js"><link rel="prefetch" href="/Blog/assets/js/52.3054df5d.js"><link rel="prefetch" href="/Blog/assets/js/53.7470179e.js"><link rel="prefetch" href="/Blog/assets/js/54.7f3159e8.js"><link rel="prefetch" href="/Blog/assets/js/55.5e8ba284.js"><link rel="prefetch" href="/Blog/assets/js/56.acb1d7cf.js"><link rel="prefetch" href="/Blog/assets/js/57.a115610c.js"><link rel="prefetch" href="/Blog/assets/js/58.a97752ca.js"><link rel="prefetch" href="/Blog/assets/js/59.0ffd11b8.js"><link rel="prefetch" href="/Blog/assets/js/6.623615b6.js"><link rel="prefetch" href="/Blog/assets/js/60.e7dc7070.js"><link rel="prefetch" href="/Blog/assets/js/61.e63abaa0.js"><link rel="prefetch" href="/Blog/assets/js/62.d32de587.js"><link rel="prefetch" href="/Blog/assets/js/63.2f3f0652.js"><link rel="prefetch" href="/Blog/assets/js/64.4f989fd3.js"><link rel="prefetch" href="/Blog/assets/js/65.e358d834.js"><link rel="prefetch" href="/Blog/assets/js/66.026d73ea.js"><link rel="prefetch" href="/Blog/assets/js/67.576ada3a.js"><link rel="prefetch" href="/Blog/assets/js/68.9f8f16af.js"><link rel="prefetch" href="/Blog/assets/js/69.07b64bdb.js"><link rel="prefetch" href="/Blog/assets/js/7.9749877c.js"><link rel="prefetch" href="/Blog/assets/js/70.2ee86b48.js"><link rel="prefetch" href="/Blog/assets/js/8.5d1f39fa.js"><link rel="prefetch" href="/Blog/assets/js/9.84e28c7d.js">
    <link rel="stylesheet" href="/Blog/assets/css/0.styles.17f0d514.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-130b300a><div data-v-130b300a><div class="password-shadow password-wrapper-out" style="display:none;" data-v-25ba6db2 data-v-130b300a data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>Vingkin的学习文档</h3> <p class="description" data-v-25ba6db2 data-v-25ba6db2>~~~</p> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>Vingkin</span>
            
          <!---->
          2023
        </a></span></div></div> <div class="hide" data-v-130b300a><header class="navbar" data-v-130b300a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Blog/" class="home-link router-link-active"><img src="/Blog/logo.gif" alt="Vingkin的学习文档" class="logo"> <span class="site-name">Vingkin的学习文档</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Blog/" class="nav-link"><i class="undefined"></i>
  Home
</a></div><div class="nav-item"><a href="/Blog/guide/interview/Java.html" class="nav-link"><i class="undefined"></i>
  Java相关
</a></div><div class="nav-item"><a href="/Blog/OS/OS1.html" class="nav-link"><i class="undefined"></i>
  操作系统
</a></div><div class="nav-item"><a href="/Blog/netty/nio/three_component.html" class="nav-link"><i class="undefined"></i>
  Netty
</a></div><div class="nav-item"><a href="/Blog/designmode/SoftwareDesignPrinciples.html" class="nav-link"><i class="undefined"></i>
  设计模式
</a></div><div class="nav-item"><a href="/Blog/ml/YOLOv3.html" class="nav-link"><i class="undefined"></i>
  机器学习
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      微服务
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/microservice/reactive/reactivestream.html" class="nav-link"><i class="undefined"></i>
  响应式编程
</a></li><li class="dropdown-item"><!----> <a href="/Blog/microservice/middleware/elasticsearch/ElasticSearchBase.html" class="nav-link"><i class="undefined"></i>
  中间件
</a></li></ul></div></div> <a href="https://github.com/vingkin/Blog" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask" data-v-130b300a></div> <aside class="sidebar" data-v-130b300a><div class="personal-info-wrapper" data-v-39576ba9 data-v-130b300a><!----> <h3 class="name" data-v-39576ba9>
    Vingkin
  </h3> <div class="num" data-v-39576ba9><div data-v-39576ba9><h3 data-v-39576ba9>60</h3> <h6 data-v-39576ba9>文章</h6></div> <div data-v-39576ba9><h3 data-v-39576ba9>0</h3> <h6 data-v-39576ba9>标签</h6></div></div> <ul class="social-links" data-v-39576ba9></ul> <hr data-v-39576ba9></div> <nav class="nav-links"><div class="nav-item"><a href="/Blog/" class="nav-link"><i class="undefined"></i>
  Home
</a></div><div class="nav-item"><a href="/Blog/guide/interview/Java.html" class="nav-link"><i class="undefined"></i>
  Java相关
</a></div><div class="nav-item"><a href="/Blog/OS/OS1.html" class="nav-link"><i class="undefined"></i>
  操作系统
</a></div><div class="nav-item"><a href="/Blog/netty/nio/three_component.html" class="nav-link"><i class="undefined"></i>
  Netty
</a></div><div class="nav-item"><a href="/Blog/designmode/SoftwareDesignPrinciples.html" class="nav-link"><i class="undefined"></i>
  设计模式
</a></div><div class="nav-item"><a href="/Blog/ml/YOLOv3.html" class="nav-link"><i class="undefined"></i>
  机器学习
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      微服务
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/microservice/reactive/reactivestream.html" class="nav-link"><i class="undefined"></i>
  响应式编程
</a></li><li class="dropdown-item"><!----> <a href="/Blog/microservice/middleware/elasticsearch/ElasticSearchBase.html" class="nav-link"><i class="undefined"></i>
  中间件
</a></li></ul></div></div> <a href="https://github.com/vingkin/Blog" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Java</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Blog/guide/interview/Java.html" class="sidebar-link">Java基础</a></li><li><a href="/Blog/guide/interview/JDK8.html" class="sidebar-link">JDK8新特性</a></li><li><a href="/Blog/guide/interview/concurrent.html" class="sidebar-link">Java并发</a></li><li><a href="/Blog/guide/interview/JVM.html" aria-current="page" class="active sidebar-link">JVM</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>系统设计</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>海量数据</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>分布式</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-25ba6db2 data-v-130b300a><h3 class="title" data-v-25ba6db2 data-v-25ba6db2>JVM</h3> <!----> <label id="box" class="inputBox" data-v-25ba6db2 data-v-25ba6db2><input type="password" value="" data-v-25ba6db2> <span data-v-25ba6db2>Konck! Knock!</span> <button data-v-25ba6db2>OK</button></label> <div class="footer" data-v-25ba6db2 data-v-25ba6db2><span data-v-25ba6db2><i class="iconfont reco-theme" data-v-25ba6db2></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-25ba6db2>vuePress-theme-reco</a></span> <span data-v-25ba6db2><i class="iconfont reco-copyright" data-v-25ba6db2></i> <a data-v-25ba6db2><span data-v-25ba6db2>Vingkin</span>
            
          <!---->
          2023
        </a></span></div></div> <div data-v-130b300a><main class="page"><section><div class="page-title"><h1 class="title">JVM</h1> <div data-v-f875f3fc><i class="iconfont reco-account" data-v-f875f3fc><span data-v-f875f3fc>Vingkin</span></i> <i class="iconfont reco-date" data-v-f875f3fc><span data-v-f875f3fc>2022-4-24</span></i> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h2 id="双亲委派机制"><a href="#双亲委派机制" class="header-anchor">#</a> 双亲委派机制</h2> <p><strong>工作原理</strong></p> <ol><li>如果一个类加载器收到了类加载的请求，它并不会自己先去加载，而是把这个请求委托给父类的加载器去执行</li> <li>如果父类加载器还存在父类加载器，则进一步向上委托，依次递归，请求最终将到达顶层的启动类加载器</li> <li>如果父类加载器可以完成类加载任务，就成功返回，倘若父类加载器无法完成此加载任务，子加载器才会尝试自己去加载，这就是双亲委派机制</li></ol> <p><strong>优点</strong></p> <ol><li>避免类的重复加载</li> <li>保护程序安全，防止核心API被随意篡改（比如：java.lang.String)</li></ol> <h2 id="沙箱安全机制"><a href="#沙箱安全机制" class="header-anchor">#</a> 沙箱安全机制</h2> <p>比如自定义String类，但是在加载自定义String类的时候会率先使用引导类加载器进行加载，而引导类加载器在加载的过程中会先加载jdk自带的文件（rt.jar包中java/lang/String.class），报错信息说没有main方法，就是因为加载的是rt.jar包中的String类。这样可以保证对java核心源代码的保护，这就是沙箱安全机制。</p> <h2 id="使用pc寄存器存储字节码指令地址有什么用呢"><a href="#使用pc寄存器存储字节码指令地址有什么用呢" class="header-anchor">#</a> 使用PC寄存器存储字节码指令地址有什么用呢？</h2> <blockquote><p>为什么用PC寄存器记录当前线程的执行地址呢</p></blockquote> <p>因为CPU需要不停的切换各个线程，这时候切换回来以后，就得知道接着从哪条指令开始继续执行（<strong>PC寄存器为什么要设定为线程私有</strong>）</p> <p>JVM的字节码解释器就需要通过改变PC寄存器的值来明确下一条应该执行什么样的字节码指令</p> <h2 id="举例栈溢出的情况"><a href="#举例栈溢出的情况" class="header-anchor">#</a> 举例栈溢出的情况</h2> <p>栈大小分为固定的，和动态变化。如果是固定的就可能出现<code>StackOverflowError</code>。如果是动态变化的，内存不足时就可能出现<code>OOM</code></p> <h2 id="方法中定义的局部变量是否线程安全"><a href="#方法中定义的局部变量是否线程安全" class="header-anchor">#</a> 方法中定义的局部变量是否线程安全</h2> <blockquote><p>还得根据变量是基本类型和引用类型两种情况分类讨论</p></blockquote> <ol><li>如果只有一个线程操作此数据，则必是线程安全的</li> <li>如果有多个线程操作此数据，则此数据是共享数据。如果不考虑同步机制的话，会存在线程安全问题。
<ul><li>如果对象是在内部产生，并在内部消亡，没有返回到外部，那么他是线程安全的，反之则是线程不安全的。（逃逸分析）</li></ul></li></ol> <h2 id="minor-gc、major-gc、full-gc"><a href="#minor-gc、major-gc、full-gc" class="header-anchor">#</a> Minor GC、Major GC、Full GC</h2> <p>JVM在进行GC时，并非每次都对三个内存（新生代、老年代；方法区）区域一起回收，大部分时候回收的都是指新生代</p> <p>针对HotSpot VM的实现，它里面的GC按照回收区域又分为两大种类型：一种是部分收集（Partial GC），一种是整堆收集（Full GC）</p> <ul><li>部分收集：不是完整收集整个Java堆的垃圾收集。其中又分为：
<ol><li>新生代收集（Minor GC / Young GC）：只是新生代的垃圾收集</li> <li>老年代收集（Major GC / Old GC）：只是老年代的垃圾收集
<ul><li>目前，只有CMS GC会有单独收集老年代的行为</li> <li><strong>注意，很多时候Major GC会和Full GC混淆使用，需要具体分析是老年代回收还是整堆回收</strong></li></ul></li> <li>混合收集（Mixed GC）：收集整个新生代以及部分老年代的垃圾收集
<ul><li>目前只有G1 GC会有这种行为</li></ul></li></ol></li> <li>整堆收集（Full GC)：收集整个Java堆和方法区的垃圾收集</li></ul> <h2 id="创建对象的方式"><a href="#创建对象的方式" class="header-anchor">#</a> 创建对象的方式</h2> <ol><li>new</li> <li>Class的newInstance()：反射的方式，只能调用空参的构造器，权限必须是public</li> <li>Constructor的newInstance(Xxx)：反射的方式，可以调用空参、带参的构造器，权限没有要求</li> <li>使用clone()：不调用任何构造器，当前类需要实现Cloneable接口，实现clone()</li> <li>使用反序列化：从文件中、网络中获取一个对象的二进制流</li></ol> <h2 id="创建对象的步骤"><a href="#创建对象的步骤" class="header-anchor">#</a> 创建对象的步骤</h2> <ol><li>判断对象对应的类是否加载、链接、初始化
<ul><li>虚拟机遇到一条new指令，首先去检查这个指令的参数能否在Metaspace的常量池中定位到一个类的符号引用，并且检查这个符号引用代表的类是否已经被加载、解析和初始化（判断类元信息是否存在）。如果没有，那么在双亲委派模式下，使用当前类加载器以ClassLoader+包名+类名为Key进行查找对应的.class文件。如果没有找到文件，则抛出ClassNotFoundException异常，如果找到，则进行类加载，并生成对应的Class类对象。</li></ul></li> <li>为对象分配内存：首先计算对象占用空间大小，接着在堆中划分一块内存给新对象。<s>如果实例成员变量是引用变量，仅分配引用变量空间即可，即4个字节大小。</s> <ul><li>如果内存规整：指针碰撞</li> <li>不规整：空闲列表</li></ul></li> <li>处理并发安全问题
<ul><li>采用CAS失败重试、区域加锁保证更新的原子性</li> <li>每个线程先分配一块TLAB</li></ul></li> <li>初始化分配到的空间：所有属性设置默认值，保证对象实例字段在不赋值时可以直接使用</li> <li>设置对象的对象头</li> <li>执行init方法进行初始化
<ul><li>在Java程序员的视角看来，初始化才正式开始。初始化成员变量，执行实例化代码块，调用类的构造方法，并把堆内对象的首地址赋值给引用变量。因此一般来说（由字节码中是否跟随由invokespecial指令所决定），new指令之后会接着就是执行方法，把对象按照程序员的意愿进行初始化，这样一个真正可用的对象才算完全创建出来。</li></ul></li></ol> <hr> <ol><li>判断对象所对应的类是否加载链接初始化，如果没有则需要在双亲委派模式下对相应的类进行加载。</li> <li>为对象分配内存。分配内存的方式有碰撞指针和空闲列表，具体使用哪种方式得看内存是否规整，规整的话使用碰撞指针否则使用空闲列表。</li> <li>内存分配的并发问题
<ul><li>采用CAS配上失败重试的方式保证操作的原子性。CAS是乐观锁的一种实现方式。</li> <li>为每个线程分配一块TLAB，TLAB是每个线程独享的，不存在线程安全问题</li></ul></li> <li>初始化零值：内存分配完成后虚拟机需要将分配到内存的空间都初始化零值，这一操作保证了对象的实例字段在Java代码中不赋值就可以使用。</li> <li>设置对象的对象头</li> <li>执行init方法：在上面的工作都完成之后，从虚拟机的角度来看，一个新的对象已经产生了，但是从Java程序的视角来看，对象创建才刚刚开始。</li></ol> <h2 id="对象的内存布局"><a href="#对象的内存布局" class="header-anchor">#</a> 对象的内存布局</h2> <ol><li>对象头
<ul><li>运行时元数据（Mark Word）
<ul><li>哈希值</li> <li>GC分代年龄</li> <li>锁状态标志</li> <li>线程持有的锁</li> <li>偏向线程ID</li> <li>偏向时间戳</li></ul></li> <li>类型指针（Klass Word）：指向类元数据InstanceKlass，确定该对象所属类型</li> <li>说明：如果是数组，还需记录数组的长度</li></ul></li> <li>实例数据
<ul><li>说明：对象真正存储的有效数据，包括程序代码中定义的各种类型的字段</li></ul></li> <li>对齐填充</li></ol> <h2 id="字符串拼接"><a href="#字符串拼接" class="header-anchor">#</a> 字符串拼接</h2> <ol><li>常量与常量引用的拼接结果在常量池，原理是编译期优化</li> <li>常量池中不会存在相同内容的变量</li> <li>拼接前后，只要其中有一个是变量，结果就在堆中。变量拼接的原理是StringBuilder</li> <li>如果拼接的结果调用intern()方法，根据该字符串是否在常量池中存在，分为：
<ul><li>如果存在，则返回字符串在常量池中的地址</li> <li>如果字符串常量池中不存在该字符串，则在常量池中创建一份，并返回此对象的地址</li></ul></li></ol> <h2 id="gc大厂面试题"><a href="#gc大厂面试题" class="header-anchor">#</a> GC大厂面试题</h2> <p><strong>蚂蚁金服</strong></p> <ol><li>你知道哪几种垃圾回收器，各自的优缺点，重点讲一下CMS和G1？</li> <li>JVM GC算法有哪些，目前的JDK版本采用什么回收算法？</li> <li>G1回收器讲下回收过程GC是什么？为什么要有GC？</li> <li>GC的两种判定方法？CMS收集器与G1收集器的特点</li></ol> <p><strong>百度</strong></p> <ol><li>说一下GC算法，分代回收说下</li> <li>垃圾收集策略和算法</li></ol> <p><strong>天猫</strong></p> <ol><li>JVM GC原理，JVM怎么回收内存</li> <li>CMS特点，垃圾回收算法有哪些？各自的优缺点，他们共同的缺点是什么？</li></ol> <p><strong>滴滴</strong></p> <ol><li>Java的垃圾回收器都有哪些，说下G1的应用场景，平时你是如何搭配使用垃圾回收器的</li></ol> <p><strong>京东</strong></p> <ol><li>你知道哪几种垃圾收集器，各自的优缺点，重点讲下CMS和G1，</li> <li>包括原理，流程，优缺点。垃圾回收算法的实现原理</li></ol> <p><strong>阿里</strong></p> <ol><li>讲一讲垃圾回收算法。</li> <li>什么情况下触发垃圾回收？</li> <li>如何选择合适的垃圾收集算法？</li> <li>JVM有哪三种垃圾回收器？</li></ol> <p><strong>字节跳动</strong></p> <ol><li>常见的垃圾回收器算法有哪些，各有什么优劣？</li> <li>System.gc()和Runtime.gc()会做什么事情？</li> <li>Java GC机制？GC Roots有哪些？</li> <li>Java对象的回收方式，回收算法。</li> <li>CMS和G1了解么，CMS解决什么问题，说一下回收的过程。</li> <li>CMS回收停顿了几次，为什么要停顿两次?</li></ol> <h2 id="增量收集算法"><a href="#增量收集算法" class="header-anchor">#</a> 增量收集算法</h2> <p><strong>基本思想</strong></p> <p>如果一次性将所有的垃圾进行处理，需要造成系统长时间的停顿，那么就可以让垃圾收集线程和应用程序线程交替执行。<strong>每次，垃圾收集线程只收集一小片区域的内存空间，接着切换到应用程序线程。依次反复，知道垃圾收集完成。</strong></p> <p><strong>缺点</strong></p> <p>使用这种方式，由于在垃圾回收过程中，间断性地还执行了应用程序代码，所以能减少系统的停顿时间。但是，因为线程和上下文切换的消耗，会使得垃圾回收的总成本上升，<strong>造成系统吞吐量的下降。</strong></p> <h2 id="system-gc-的理解"><a href="#system-gc-的理解" class="header-anchor">#</a> System.gc()的理解</h2> <p>在默认情况下，通过System.gc()或者Runtime.getRuntime().gc()的调用，会显式触发Full GC，同时对老年代和新生代进行回收，尝试释放被丢弃对象占用的内存。</p> <h2 id="内存溢出和内存泄漏的原因"><a href="#内存溢出和内存泄漏的原因" class="header-anchor">#</a> 内存溢出和内存泄漏的原因</h2> <p><strong>内存溢出</strong></p> <ol><li>Java虚拟机的堆内存设置不够</li> <li>代码中创建了大量大对象，并且长时间不能被垃圾收集器收集</li></ol> <p><strong>内存泄漏</strong></p> <ol><li>单例对象：单例的生命周期和应用程序是一样长的，所以单例程序中，如果持有对外部对象的引用的话，那么这个外部对象是不能被回收的，则会导致内存泄露的产生。</li> <li>一些提供close的资源未关闭导致内存泄漏</li></ol> <h2 id="评估gc的性能指标"><a href="#评估gc的性能指标" class="header-anchor">#</a> 评估GC的性能指标</h2> <ol><li><p><strong>吞吐量</strong>：运行用户代码的时间占总运行时间的比例（总运行时间 = 程序的运行时间a + 内存回收的时间b）a/(a+b)</p></li> <li><p>垃圾收集开销：吞吐量的补数，垃圾收集所用时间与总运行时间的比例。</p></li> <li><p><strong>暂停时间</strong>：执行垃圾收集时，程序的工作线程被暂停的时间。</p></li> <li><p>收集频率：相对于应用程序的执行，收集操作发生的频率。</p></li> <li><p><strong>内存占用</strong>：Java堆区所占的内存大小。</p></li> <li><p>快速：一个对象从诞生到被回收所经历的时间。</p></li> <li><p>吞吐量、暂停时间、内存占用这三者共同构成一个“不可能三角”。三者总体的表现会随着技术进步而越来越好。一款优秀的收集器通常最多同时满足其中的两项。</p></li> <li><p>这三项里，暂停时间的重要性日益凸显。因为随着硬件发展，内存占用多些越来越能容忍，硬件性能的提升也有助于降低收集器运行时对应用程序的影响，即提高了吞吐量。而内存的扩大，对延迟反而带来负面效果。</p></li> <li><p>简单来说，主要抓住两点：</p> <ul><li>吞吐量</li> <li>暂停时间</li></ul></li></ol> <h2 id="_7种经典的垃圾回收器"><a href="#_7种经典的垃圾回收器" class="header-anchor">#</a> 7种经典的垃圾回收器</h2> <p><img src="https://unpkg.zhimg.com/youthlql@1.0.8/JVM/chapter_012/0034.jpg" alt=""></p> <p><strong>以串并行分类</strong>：</p> <ol><li>串行回收器：Serial、Serial old</li> <li>并行回收器：ParNew、Parallel Scavenge、Parallel old</li> <li>并发回收器：CMS、G1</li></ol> <p><strong>分代分类：</strong></p> <ol><li>新生代收集器：Serial、ParNew、Parallel Scavenge；</li> <li>老年代收集器：Serial old、Parallel old、CMS；</li> <li>整堆收集器：G1；</li></ol> <p><img src="https://unpkg.zhimg.com/youthlql@1.0.8/JVM/chapter_012/0007.png" alt=""></p> <p><strong>垃圾收集器组合关系：</strong></p> <p><img src="https://unpkg.zhimg.com/youthlql@1.0.8/JVM/chapter_012/0008.png" alt=""></p> <ol><li><p>两个收集器间有连线，表明它们可以搭配使用：</p> <ul><li>Serial/Serial old</li> <li>Serial/CMS （JDK9废弃）</li> <li>ParNew/Serial Old （JDK9废弃）</li> <li>ParNew/CMS</li> <li>Parallel Scavenge/Serial Old （预计废弃）</li> <li>Parallel Scavenge/Parallel Old</li> <li>G1</li></ul></li> <li><p>其中Serial Old作为CMS出现”Concurrent Mode Failure”失败的后备预案。</p></li> <li><p>（红色虚线）由于维护和兼容性测试的成本，在JDK 8时将Serial+CMS、ParNew+Serial Old这两个组合声明为废弃（JEP173），并在JDK9中完全取消了这些组合的支持（JEP214），即：移除。</p></li> <li><p>（绿色虚线）JDK14中：弃用Parallel Scavenge和Serial Old GC组合（JEP366）</p></li> <li><p>（青色虚线）JDK14中：删除CMS垃圾回收器（JEP363）</p></li> <li><p>为什么要有很多收集器，一个不够吗？因为Java的使用场景很多，移动端，服务器等。所以就需要针对不同的场景，提供不同的垃圾收集器，提高垃圾收集的性能。</p></li> <li><p>虽然我们会对各个收集器进行比较，但并非为了挑选一个最好的收集器出来。没有一种放之四海皆准、任何场景下都适用的完美收集器存在，更加没有万能的收集器。所以<strong>我们选择的只是对具体应用最合适的收集器</strong>。</p></li></ol> <h2 id="垃圾回收器的选择"><a href="#垃圾回收器的选择" class="header-anchor">#</a> 垃圾回收器的选择</h2> <blockquote><p>HotSpot有这么多的垃圾回收器，那么如果有人问，Serial GC、Parallel GC、Concurrent Mark Sweep GC这三个GC有什么不同呢？</p></blockquote> <ol><li>如果你想要最小化地使用内存和并行开销，请选Serial GC；</li> <li>如果你想要最大化应用程序的吞吐量，请选Parallel GC；</li> <li>如果你想要最小化GC的中断或停顿时间，请选CMS GC。</li></ol> <h2 id="jdk-后续版本中-cms-的变化"><a href="#jdk-后续版本中-cms-的变化" class="header-anchor">#</a> JDK 后续版本中 CMS 的变化</h2> <ol><li>JDK9新特性：CMS被标记为Deprecate了（JEP291）
<ul><li>如果对JDK9及以上版本的HotSpot虚拟机使用参数-XX:+UseConcMarkSweepGC来开启CMS收集器的话，用户会收到一个警告信息，提示CMS未来将会被废弃。</li></ul></li> <li>JDK14新特性：删除CMS垃圾回收器（JEP363）移除了CMS垃圾收集器，
<ul><li>如果在JDK14中使用XX:+UseConcMarkSweepGC的话，JVM不会报错，只是给出一个warning信息，但是不会exit。JVM会自动回退以默认GC方式启动JVM</li></ul></li></ol></div></section> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/vingkin/Blog/edit/docs/docs/guide/interview/JVM.md" target="_blank" rel="noopener noreferrer">编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/Blog/guide/interview/concurrent.html" class="prev">
            Java并发
          </a></span> <span class="next"><a href="/Blog/guide/interview/Idempotency.html">
            幂等
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-cb1513f6><li class="level-2" data-v-cb1513f6><a href="/Blog/guide/interview/JVM.html#双亲委派机制" class="sidebar-link reco-side-双亲委派机制" data-v-cb1513f6>双亲委派机制</a></li><li class="level-2" data-v-cb1513f6><a href="/Blog/guide/interview/JVM.html#沙箱安全机制" class="sidebar-link reco-side-沙箱安全机制" data-v-cb1513f6>沙箱安全机制</a></li><li class="level-2" data-v-cb1513f6><a href="/Blog/guide/interview/JVM.html#使用pc寄存器存储字节码指令地址有什么用呢" class="sidebar-link reco-side-使用pc寄存器存储字节码指令地址有什么用呢" data-v-cb1513f6>使用PC寄存器存储字节码指令地址有什么用呢？</a></li><li class="level-2" data-v-cb1513f6><a href="/Blog/guide/interview/JVM.html#举例栈溢出的情况" class="sidebar-link reco-side-举例栈溢出的情况" data-v-cb1513f6>举例栈溢出的情况</a></li><li class="level-2" data-v-cb1513f6><a href="/Blog/guide/interview/JVM.html#方法中定义的局部变量是否线程安全" class="sidebar-link reco-side-方法中定义的局部变量是否线程安全" data-v-cb1513f6>方法中定义的局部变量是否线程安全</a></li><li class="level-2" data-v-cb1513f6><a href="/Blog/guide/interview/JVM.html#minor-gc、major-gc、full-gc" class="sidebar-link reco-side-minor-gc、major-gc、full-gc" data-v-cb1513f6>Minor GC、Major GC、Full GC</a></li><li class="level-2" data-v-cb1513f6><a href="/Blog/guide/interview/JVM.html#创建对象的方式" class="sidebar-link reco-side-创建对象的方式" data-v-cb1513f6>创建对象的方式</a></li><li class="level-2" data-v-cb1513f6><a href="/Blog/guide/interview/JVM.html#创建对象的步骤" class="sidebar-link reco-side-创建对象的步骤" data-v-cb1513f6>创建对象的步骤</a></li><li class="level-2" data-v-cb1513f6><a href="/Blog/guide/interview/JVM.html#对象的内存布局" class="sidebar-link reco-side-对象的内存布局" data-v-cb1513f6>对象的内存布局</a></li><li class="level-2" data-v-cb1513f6><a href="/Blog/guide/interview/JVM.html#字符串拼接" class="sidebar-link reco-side-字符串拼接" data-v-cb1513f6>字符串拼接</a></li><li class="level-2" data-v-cb1513f6><a href="/Blog/guide/interview/JVM.html#gc大厂面试题" class="sidebar-link reco-side-gc大厂面试题" data-v-cb1513f6>GC大厂面试题</a></li><li class="level-2" data-v-cb1513f6><a href="/Blog/guide/interview/JVM.html#增量收集算法" class="sidebar-link reco-side-增量收集算法" data-v-cb1513f6>增量收集算法</a></li><li class="level-2" data-v-cb1513f6><a href="/Blog/guide/interview/JVM.html#system-gc-的理解" class="sidebar-link reco-side-system-gc-的理解" data-v-cb1513f6>System.gc()的理解</a></li><li class="level-2" data-v-cb1513f6><a href="/Blog/guide/interview/JVM.html#内存溢出和内存泄漏的原因" class="sidebar-link reco-side-内存溢出和内存泄漏的原因" data-v-cb1513f6>内存溢出和内存泄漏的原因</a></li><li class="level-2" data-v-cb1513f6><a href="/Blog/guide/interview/JVM.html#评估gc的性能指标" class="sidebar-link reco-side-评估gc的性能指标" data-v-cb1513f6>评估GC的性能指标</a></li><li class="level-2" data-v-cb1513f6><a href="/Blog/guide/interview/JVM.html#_7种经典的垃圾回收器" class="sidebar-link reco-side-_7种经典的垃圾回收器" data-v-cb1513f6>7种经典的垃圾回收器</a></li><li class="level-2" data-v-cb1513f6><a href="/Blog/guide/interview/JVM.html#垃圾回收器的选择" class="sidebar-link reco-side-垃圾回收器的选择" data-v-cb1513f6>垃圾回收器的选择</a></li><li class="level-2" data-v-cb1513f6><a href="/Blog/guide/interview/JVM.html#jdk-后续版本中-cms-的变化" class="sidebar-link reco-side-jdk-后续版本中-cms-的变化" data-v-cb1513f6>JDK 后续版本中 CMS 的变化</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/Blog/assets/js/app.4417eb82.js" defer></script><script src="/Blog/assets/js/3.2daec6eb.js" defer></script><script src="/Blog/assets/js/1.3441dec7.js" defer></script><script src="/Blog/assets/js/31.c79fd8b8.js" defer></script>
  </body>
</html>
